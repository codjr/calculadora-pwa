<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Frases Infinitas Di√°rias</title>
<meta name="theme-color" content="#0ea5e9"/>
<link rel="manifest" href="manifest.json">
<link rel="icon" sizes="192x192" href="icons/imagem_icon_192x192.png">

<style>
body{
  margin:0;font-family:system-ui,Inter,Roboto;
  background:#0b1220;color:#e5e7eb;
  display:flex;flex-direction:column;align-items:center;
  justify-content:center;height:100vh;text-align:center;padding:20px;
}
h1{color:#38bdf8;font-size:1.8em;margin:0 0 10px}
p{font-size:1.2em;line-height:1.4em;margin:20px 0}
button{
  background:#38bdf8;color:#00111a;border:none;border-radius:8px;
  padding:10px 16px;font-size:1em;font-weight:600;cursor:pointer;
  margin:4px;transition:.2s;
}
button:hover{background:#22d3ee;transform:translateY(-1px)}
input[type=time]{border-radius:8px;border:none;padding:6px 10px;
  font-size:1em;margin-top:8px}
.small{font-size:.85em;color:#94a3b8;margin-top:10px}
.toast{
  position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
  background:#0ea5e9;color:#fff;padding:10px 16px;border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.4);animation:fadeInOut 2s ease forwards;
}
@keyframes fadeInOut{0%{opacity:0;transform:translate(-50%,10px)}
20%{opacity:1;transform:translate(-50%,0)}
80%{opacity:1}
100%{opacity:0;transform:translate(-50%,10px)}}
</style>
</head>
<body>
<h1>‚ú® Frases Infinitas Di√°rias</h1>
<p id="frase">Gerando sua frase...</p>
<div>
  <button id="btn">Nova Frase</button>
  <button id="btnVoz">üîä Ler Frase</button><br>
  <button id="btnNoti">üîî Ativar Notifica√ß√µes</button>
  <button id="btnTestar">üì¢ Testar Notifica√ß√£o</button>
</div>
<div style="margin-top:12px">
  <label for="hora">üïó Hor√°rio da notifica√ß√£o:</label><br>
  <input type="time" id="hora" value="08:00">
</div>
<div class="small">Funciona offline, atualiza automaticamente e envia uma frase nova todos os dias.</div>

<script>
/* === Frases base === */
const frases=[
  "Acredite em voc√™ e v√° al√©m! üöÄ",
  "A disciplina vence o cansa√ßo. üí™",
  "Hoje √© o dia perfeito para come√ßar! üåü",
  "Voc√™ √© capaz de mudar tudo! üî•",
  "Um passo de cada vez. üß≠",
  "Persist√™ncia constr√≥i resultados. üèÅ",
  "A a√ß√£o cura a d√∫vida. üéØ",
  "O imposs√≠vel s√≥ existe at√© ser feito. ‚ú®"
];
const fraseEl=document.getElementById("frase");
const fraseSalva=localStorage.getItem("fraseHoje");
fraseEl.textContent=fraseSalva||frases[0];
function gerarFrase(){
  const f=frases[Math.floor(Math.random()*frases.length)];
  fraseEl.textContent=f;
  localStorage.setItem("fraseHoje",f);
  toast("Nova frase gerada!");
}
document.getElementById("btn").onclick=gerarFrase;

/* === Leitura por voz === */
const synth=window.speechSynthesis;
document.getElementById("btnVoz").onclick=()=>{
  const texto=fraseEl.textContent;
  if(synth.speaking) synth.cancel();
  const voz=new SpeechSynthesisUtterance(texto);
  voz.lang="pt-BR";
  synth.speak(voz);
};

/* === Toast simples === */
function toast(msg){
  const t=document.createElement("div");
  t.className="toast";
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2000);
}

/* === Registrar Service Worker === */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js")
  .then(()=>console.log("‚úÖ Service Worker registrado"));
  // Atualiza√ß√£o autom√°tica ao detectar nova vers√£o
  navigator.serviceWorker.addEventListener("message",e=>{
    if(e.data && e.data.type==="UPDATE_AVAILABLE"){
      toast("üîÑ Nova vers√£o dispon√≠vel, atualizando...");
      setTimeout(()=>location.reload(),1000);
    }
  });
}

/* === Notifica√ß√µes === */
const btnNoti=document.getElementById("btnNoti");
const btnTestar=document.getElementById("btnTestar");
const horaInput=document.getElementById("hora");
const KEY_ACTIVE="notiAtiva",KEY_HORA="notiHora";
horaInput.value=localStorage.getItem(KEY_HORA)||"08:00";

btnNoti.onclick=async()=>{
  if(localStorage.getItem(KEY_ACTIVE)==="1"){
    localStorage.removeItem(KEY_ACTIVE);
    btnNoti.textContent="üîï Ativar Notifica√ß√µes";
    toast("Notifica√ß√µes desativadas");
  }else{
    const perm=await Notification.requestPermission();
    if(perm==="granted"){
      localStorage.setItem(KEY_ACTIVE,"1");
      btnNoti.textContent="üîî Desativar Notifica√ß√µes";
      registrarPeriodicSync();
      toast("Notifica√ß√µes ativadas!");
    }else toast("Permita notifica√ß√µes para ativar o lembrete di√°rio");
  }
};

horaInput.onchange=()=>{
  localStorage.setItem(KEY_HORA,horaInput.value);
  if(localStorage.getItem(KEY_ACTIVE)==="1"){
    toast("Hor√°rio salvo: "+horaInput.value);
    agendarNotificacao();
  }
};

function agendarNotificacao(){
  if(localStorage.getItem(KEY_ACTIVE)!=="1")return;
  const hora=localStorage.getItem(KEY_HORA)||"08:00";
  const [h,m]=hora.split(":").map(Number);
  const agora=new Date();
  const proxima=new Date();
  proxima.setHours(h,m,0,0);
  if(proxima<agora)proxima.setDate(proxima.getDate()+1);
  const delay=proxima-agora;
  console.log("‚è≥ Pr√≥xima notifica√ß√£o em",Math.round(delay/1000/60),"min");
  setTimeout(()=>mostrarNotificacao(),delay);
}

function mostrarNotificacao(){
  const f=frases[Math.floor(Math.random()*frases.length)];
  navigator.serviceWorker.getRegistration().then(reg=>{
    reg.showNotification("Frase do Dia üåû",{
      body:f,
      icon:"icons/imagem_icon_192x192.png",
      badge:"icons/imagem_icon_96x96.png"
    });
  });
  setTimeout(mostrarNotificacao,24*60*60*1000);
}

/* === Bot√£o de teste imediato === */
btnTestar.onclick=()=>{
  const f=frases[Math.floor(Math.random()*frases.length)];
  navigator.serviceWorker.getRegistration().then(reg=>{
    reg.showNotification("üì¢ Teste de Notifica√ß√£o",{body:f,icon:"icons/imagem_icon_192x192.png"});
  });
  toast("Notifica√ß√£o de teste enviada!");
};

/* === Background Sync di√°rio === */
async function registrarPeriodicSync(){
  if('periodicSync' in navigator.serviceWorker){
    try{
      const reg=await navigator.serviceWorker.ready;
      const tags=await reg.periodicSync.getTags();
      if(!tags.includes("frase-diaria")){
        await reg.periodicSync.register("frase-diaria",{minInterval:24*60*60*1000});
        console.log("‚úÖ Periodic Sync registrado (frase-diaria)");
      }
    }catch(err){
      console.warn("‚ö†Ô∏è periodicSync n√£o dispon√≠vel",err);
      agendarNotificacao();
    }
  }else{
    console.log("‚è≥ periodicSync n√£o suportado, usando fallback.");
    agendarNotificacao();
  }
}

if(localStorage.getItem(KEY_ACTIVE)==="1"){
  btnNoti.textContent="üîî Desativar Notifica√ß√µes";
  registrarPeriodicSync();
}
</script>
</body>
</html>
