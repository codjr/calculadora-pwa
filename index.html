<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Calculadora PWA</title>

  <!-- Manifest antigo (JSON) -->
  <link rel="manifest" href="manifest.json" type="application/manifest+json">
  <meta name="theme-color" content="#111827">
  <link rel="icon" href="icons/icon-192.png" sizes="192x192" type="image/png">

  <style>
    :root {
      --bg:#0b1220;--panel:#111827;--panel2:#0f172a;
      --txt:#e5e7eb;--muted:#9ca3af;--acc:#22c55e;--danger:#ef4444;--btn:#1f2937;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Inter,Roboto,Arial,sans-serif;background:var(--bg);color:var(--txt);display:flex;align-items:center;justify-content:center}
    .app{width:min(420px,94vw);padding:16px}
    .wrap{background:var(--panel);border-radius:16px;box-shadow:0 16px 60px rgba(0,0,0,.35);overflow:hidden;border:1px solid #1f2937}
    header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:var(--panel2);border-bottom:1px solid #1f2937}
    header h1{font-size:14px;margin:0;color:var(--muted)}
    .display{padding:18px 16px;text-align:right}
    .expr{min-height:28px;color:var(--muted);font-size:14px;word-wrap:break-word}
    .result{min-height:48px;font-size:36px;font-weight:700}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:12px;background:var(--panel)}
    button{border:0;border-radius:12px;padding:16px;font-size:18px;background:var(--btn);color:var(--txt);cursor:pointer;font-weight:600}
    button:active{transform:translateY(1px)}
    .op{background:#1e293b}
    .eq{background:var(--acc);color:#052e16}
    .danger{background:#3f1c1f;color:#fecaca}
    .span-2{grid-column:span 2}
    .footer{text-align:center;color:var(--muted);font-size:12px;margin-top:8px}
  </style>
</head>
<body>
  <div class="app">
    <div class="wrap">
      <header><h1>Calculadora</h1><span id="net">—</span></header>
      <div class="display">
        <div id="expr" class="expr"></div>
        <div id="result" class="result">0</div>
      </div>
      <div class="grid">
        <button class="danger" data-k="AC">AC</button>
        <button class="op" data-k="(">(</button>
        <button class="op" data-k=")">)</button>
        <button class="op" data-k="/">÷</button>
        <button data-k="7">7</button>
        <button data-k="8">8</button>
        <button data-k="9">9</button>
        <button class="op" data-k="*">×</button>
        <button data-k="4">4</button>
        <button data-k="5">5</button>
        <button data-k="6">6</button>
        <button class="op" data-k="-">−</button>
        <button data-k="1">1</button>
        <button data-k="2">2</button>
        <button data-k="3">3</button>
        <button class="op" data-k="+">+</button>
        <button data-k="0" class="span-2">0</button>
        <button data-k=".">.</button>
        <button class="op" data-k="%">%</button>
        <button class="danger" data-k="DEL">DEL</button>
        <button class="eq span-2" data-k="=">=</button>
        <button class="op" data-k="^">xʸ</button>
      </div>
    </div>
    <div class="footer">PWA • Offline • Firebase Conectado</div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { app } from "./firebase-config.js";
    console.log("Firebase conectado:", app.name);
  </script>

  <!-- Lógica + SW -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/calculadora-pwa/sw.js', { scope: '/calculadora-pwa/' })
        .then(() => console.log("✅ Service Worker registrado"))
        .catch(err => console.error("❌ Erro SW:", err));
    }

    const net = document.getElementById('net');
    const updateNet = () => net.textContent = navigator.onLine ? 'Online' : 'Offline';
    window.addEventListener('online', updateNet);
    window.addEventListener('offline', updateNet);
    updateNet();

    const exprEl = document.getElementById('expr');
    const resEl = document.getElementById('result');
    let expr='', res='0';

    document.querySelectorAll('[data-k]').forEach(b => b.onclick = () => press(b.dataset.k));

    function press(k) {
      if (k==='AC'){expr='';res='0';draw();return;}
      if (k==='DEL'){expr=expr.slice(0,-1);draw();return;}
      if (k==='='){calc();return;}
      append(k);draw();
    }

    function append(k) {
      if(k==='×')k='*'; if(k==='÷')k='/';
      const ops=['+','-','*','/','%','^'],last=expr.slice(-1);
      if(expr===''&&ops.includes(k)&&k!=='-')return;
      if(ops.includes(last)&&ops.includes(k)){expr=expr.slice(0,-1)+k;return;}
      expr+=k;
    }

    function calc() {
      if(!expr){res='0';return draw();}
      let safe=expr.replace(/\^/g,'**');
      try{const v=Function('"use strict";return('+safe+')')();res=(+Number(v).toFixed(10)).toString();expr=''+v;}
      catch{res='Erro';}
      draw();
    }

    function draw(){exprEl.textContent=expr;resEl.textContent=res;}
  </script>
</body>
</html>
